<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stuxnet Pro Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lightweight-charts@4.1.1/dist/lightweight-charts.standalone.production.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=Padauk:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Outfit', 'Padauk', sans-serif; background-color: #000000; color: #f5f5f7; }
        
        /* Apple-style Glassmorphism */
        .glass-card {
            background: rgba(28, 28, 30, 0.65);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.12);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
            border-radius: 20px;
        }

        /* Apple Border Glow */
        .apple-glow:hover {
            box-shadow: 0 0 20px rgba(0, 113, 227, 0.4);
            border-color: rgba(0, 113, 227, 0.5);
            transform: scale(1.01);
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        /* Apple Button */
        .apple-btn {
            background: rgba(0, 113, 227, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 9999px;
            backdrop-filter: blur(10px);
            transition: all 0.2s ease;
        }
        .apple-btn:hover {
            background: rgba(0, 122, 255, 1);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 113, 227, 0.3);
        }

        .neon-text { text-shadow: 0 0 15px rgba(0, 113, 227, 0.6); }
        .ticker-move { animation: ticker 35s linear infinite; }
        @keyframes ticker { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
        
        /* Custom Scrollbar (Invisible/Apple-like) */
        ::-webkit-scrollbar { width: 0px; background: transparent; }
    </style>
</head>
<body class="overflow-x-hidden">

    <!-- Navbar & Marquee -->
    <nav class="fixed top-0 w-full z-50 bg-[#000000]/70 backdrop-blur-xl border-b border-white/10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-full bg-white/10 flex items-center justify-center backdrop-blur-md border border-white/10">
                         <span class="font-bold text-white text-sm">SP</span>
                    </div>
                    <span class="text-lg font-semibold tracking-tight text-white drop-shadow-[0_0_10px_rgba(255,255,255,0.3)]">
                        Stuxnet Pro Dashboard
                    </span>
                </div>
                <div class="hidden md:flex space-x-8 text-[13px] tracking-wide text-gray-300 font-medium">
                    <a href="#" class="hover:text-white transition ease-out duration-300">Crypto</a>
                    <a href="#" class="hover:text-white transition ease-out duration-300">Stocks</a>
                    <a href="#" class="hover:text-white transition ease-out duration-300">Commodities</a>
                    <a href="#" class="hover:text-white transition ease-out duration-300">AI Intelligence</a>
                </div>
                <div class="flex items-center gap-4">
                     <div id="yangon-weather" class="text-[11px] font-medium text-blue-400 bg-blue-500/10 px-3 py-1.5 rounded-full border border-blue-500/20 flex items-center gap-2 backdrop-blur-md">
                        <span>üå¶Ô∏è YGN</span>
                    </div>
                    <button class="apple-btn text-white px-5 py-1.5 text-xs font-medium tracking-wide">
                        Connect ID
                    </button>
                </div>
            </div>
        </div>
        <!-- Live Ticker -->
        <div class="h-8 bg-black/40 flex items-center overflow-hidden border-t border-gray-800">
            <div class="whitespace-nowrap ticker-move text-xs font-mono text-gray-400" id="marquee-ticker">
                BTC: Loading... ‚Ä¢ ETH: Loading... ‚Ä¢ GOLD: $5,081 ‚Ä¢ OIL: $78.20 ‚Ä¢ SOL: Loading...
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="pt-28 pb-12 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto space-y-6">
        
        <!-- Top Stats Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            <!-- BTC Card -->
            <div class="glass-card p-6 apple-glow cursor-default relative overflow-hidden group">
                <div class="absolute inset-0 bg-gradient-to-br from-orange-500/5 to-transparent pointer-events-none"></div>
                <div class="flex justify-between items-start z-10 relative">
                    <div>
                        <p class="text-[11px] uppercase tracking-wider text-gray-400 font-semibold mb-1">Bitcoin</p>
                        <h3 class="text-3xl font-medium tracking-tight text-white transition-all duration-300" id="price-btc">Wait...</h3>
                    </div>
                    <div class="w-8 h-8 rounded-full bg-orange-500/20 flex items-center justify-center">
                        <svg class="w-4 h-4 text-orange-500" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>
                    </div>
                </div>
                <div class="mt-4 flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                    <span class="text-[10px] text-green-400 font-medium tracking-wide">MARKET OPEN</span>
                </div>
            </div>

            <!-- ETH Card -->
            <div class="glass-card p-6 apple-glow cursor-default relative overflow-hidden group">
                <div class="absolute inset-0 bg-gradient-to-br from-purple-500/5 to-transparent pointer-events-none"></div>
                <div class="flex justify-between items-start z-10 relative">
                    <div>
                        <p class="text-[11px] uppercase tracking-wider text-gray-400 font-semibold mb-1">Ethereum</p>
                        <h3 class="text-3xl font-medium tracking-tight text-white transition-all duration-300" id="price-eth">Wait...</h3>
                    </div>
                    <div class="w-8 h-8 rounded-full bg-purple-500/20 flex items-center justify-center">
                         <svg class="w-4 h-4 text-purple-400" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2L2 12l10 10 10-10L12 2zm0 4.2L17.8 11 12 16.8 6.2 11 12 6.2z"/></svg>
                    </div>
                </div>
                <div class="mt-4 flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                    <span class="text-[10px] text-green-400 font-medium tracking-wide">MARKET OPEN</span>
                </div>
            </div>

            <!-- Gold Card -->
            <div class="glass-card p-6 apple-glow cursor-default relative overflow-hidden group">
                <div class="absolute inset-0 bg-gradient-to-br from-yellow-500/5 to-transparent pointer-events-none"></div>
                <div class="flex justify-between items-start z-10 relative">
                    <div>
                        <p class="text-[11px] uppercase tracking-wider text-gray-400 font-semibold mb-1">Gold (XAU)</p>
                        <h3 class="text-3xl font-medium tracking-tight text-yellow-100 transition-all duration-300" id="price-gold">$5,081.60</h3>
                    </div>
                    <span class="text-[10px] font-mono text-yellow-500/80 border border-yellow-500/20 px-2 py-0.5 rounded-full">OZ</span>
                </div>
                <div class="mt-4 text-[10px] text-gray-500 flex items-center gap-1">
                    Global Spot Market
                </div>
            </div>

            <!-- Oil Card -->
            <div class="glass-card p-6 apple-glow cursor-default relative overflow-hidden group">
                 <div class="absolute inset-0 bg-gradient-to-br from-red-500/5 to-transparent pointer-events-none"></div>
                <div class="flex justify-between items-start z-10 relative">
                    <div>
                        <p class="text-[11px] uppercase tracking-wider text-gray-400 font-semibold mb-1">Crude Oil</p>
                        <h3 class="text-3xl font-medium tracking-tight text-red-100 transition-all duration-300" id="price-oil">$78.45</h3>
                    </div>
                     <span class="text-[10px] font-mono text-red-500/80 border border-red-500/20 px-2 py-0.5 rounded-full">WTI</span>
                </div>
                 <div class="mt-4 text-[10px] text-gray-500 flex items-center gap-1">
                    Energy Futures
                </div>
            </div>
        </div>

        <!-- Main Chart & AI Analysis -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 h-[600px]">
            <!-- Chart Section (2 cols) -->
            <div class="lg:col-span-2 glass-card rounded-2xl p-1 flex flex-col h-full relative">
                <div class="absolute top-4 left-4 z-10 flex gap-2">
                    <button class="px-3 py-1 bg-blue-600 text-xs rounded hover:bg-blue-500 text-white font-semibold">BTC/USD</button>
                    <span class="px-3 py-1 bg-gray-800 text-xs rounded text-gray-400">1H Candle</span>
                </div>
                <!-- Explicit height/width for chart container -->
                <div id="trading-chart" class="w-full h-full rounded-xl overflow-hidden bg-gray-900" style="min-height: 500px;"></div>
            </div>

            <!-- AI Insights Panel (1 col) -->
            <div class="glass-card rounded-2xl p-6 flex flex-col h-full">
                <div class="flex items-center justify-between mb-4 border-b border-gray-700 pb-2">
                    <h3 class="text-lg font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-400">
                        ü§ñ Ko Paing AI Insights
                    </h3>
                    <span class="text-[10px] bg-green-500/20 text-green-400 px-2 py-0.5 rounded-full animate-pulse">LIVE</span>
                </div>
                
                <div class="flex-1 overflow-y-auto space-y-4 pr-2" id="ai-analysis-feed">
                    <div class="animate-pulse space-y-3">
                        <div class="h-2 bg-gray-700 rounded col-span-2"></div>
                        <div class="h-2 bg-gray-700 rounded col-span-1"></div>
                        <div class="h-20 bg-gray-800 rounded-lg"></div>
                        <p class="text-xs text-gray-500 text-center">Analysing Market...</p>
                    </div>
                </div>

                <!-- Alert Input -->
                <div class="mt-4 pt-4 border-t border-gray-700">
                    <label class="text-xs text-gray-400 mb-1 block">Set Price Alert (BTC)</label>
                    <div class="flex gap-2">
                        <input type="number" placeholder="$100,000" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 text-sm text-white focus:outline-none focus:border-blue-500">
                        <button class="bg-blue-600 hover:bg-blue-500 px-3 rounded text-white text-sm">Set</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Market Grid (Commodities & Forex) -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="glass-card p-5 rounded-2xl">
                <h4 class="text-gray-400 text-sm mb-3">Forex (Major Pairs)</h4>
                <div class="space-y-3">
                    <div class="flex justify-between text-sm"><span class="text-gray-300">EUR/USD</span> <span class="text-green-400">1.0845 (+0.1%)</span></div>
                    <div class="flex justify-between text-sm"><span class="text-gray-300">GBP/USD</span> <span class="text-red-400">1.2630 (-0.2%)</span></div>
                    <div class="flex justify-between text-sm"><span class="text-gray-300">USD/JPY</span> <span class="text-green-400">151.20 (+0.5%)</span></div>
                </div>
            </div>
            <div class="glass-card p-5 rounded-2xl">
                <h4 class="text-gray-400 text-sm mb-3">Tech Stocks</h4>
                <div class="space-y-3">
                    <div class="flex justify-between text-sm"><span class="text-gray-300">NVDA</span> <span class="text-green-400">$950.40 (+3.2%)</span></div>
                    <div class="flex justify-between text-sm"><span class="text-gray-300">TSLA</span> <span class="text-red-400">$175.20 (-1.5%)</span></div>
                    <div class="flex justify-between text-sm"><span class="text-gray-300">AAPL</span> <span class="text-gray-400">$172.50 (0.0%)</span></div>
                </div>
            </div>
            <div class="glass-card p-5 rounded-2xl bg-gradient-to-br from-blue-900/20 to-purple-900/20">
                <h4 class="text-gray-400 text-sm mb-2">Fear & Greed Index</h4>
                <div class="flex items-center justify-center h-24">
                    <div class="text-center">
                        <span class="text-4xl font-bold text-green-400">79</span>
                        <p class="text-xs text-green-300 mt-1">Extreme Greed</p>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <script>
        // --- 1. TradingView Lightweight Chart (Robust Setup) ---
        let candleSeries; // Declare globally

        window.onload = function() {
            const chartContainer = document.getElementById('trading-chart');
            if (window.LightweightCharts) {
                const chart = LightweightCharts.createChart(chartContainer, {
                    layout: { background: { type: 'solid', color: '#111827' }, textColor: '#d1d5db' },
                    grid: { vertLines: { color: '#1f2937' }, horzLines: { color: '#1f2937' } },
                    width: chartContainer.clientWidth,
                    height: chartContainer.clientHeight || 500,
                    rightPriceScale: { borderColor: '#374151' },
                    timeScale: { borderColor: '#374151' },
                });

                candleSeries = chart.addCandlestickSeries({
                    upColor: '#22c55e', downColor: '#ef4444', borderUpColor: '#22c55e', borderDownColor: '#ef4444',
                    wickUpColor: '#22c55e', wickDownColor: '#ef4444',
                });

                // Generate Mock Data (Realistic $66k range)
                function generateData() {
                    let data = [];
                    let time = Math.floor(Date.now() / 1000) - (200 * 3600);
                    let open = 66500; 
                    for (let i = 0; i < 200; i++) {
                        let close = open + (Math.random() - 0.5) * 400;
                        let high = Math.max(open, close) + Math.random() * 200;
                        let low = Math.min(open, close) - Math.random() * 200;
                        data.push({ time: time + i * 3600, open, high, low, close });
                        open = close;
                    }
                    return data;
                }
                candleSeries.setData(generateData());

                // Auto Resize
                new ResizeObserver(entries => {
                    if (entries.length === 0 || entries[0].target !== chartContainer) { return; }
                    const newRect = entries[0].contentRect;
                    chart.applyOptions({ height: newRect.height, width: newRect.width });
                }).observe(chartContainer);
            } else {
                chartContainer.innerHTML = "<p class='text-red-500 p-10 text-center'>Chart Library Failed to Load. Please Refresh.</p>";
            }
        };

        // --- 2. Live Price Updates (Binance + Simulation) ---
        let lastBtcPrice = 0;
        let lastEthPrice = 0;
        let currentCandle = null;

        function connectWebSocket() {
            const ws = new WebSocket('wss://stream.binance.com:9443/ws/btcusdt@trade/ethusdt@trade');
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                const price = parseFloat(data.p);
                const priceStr = price.toFixed(2);
                
                if (data.s === 'BTCUSDT') {
                    const el = document.getElementById('price-btc');
                    if(el) { 
                        // Flash effect logic
                        if(price > lastBtcPrice) {
                            el.classList.remove('text-red-500', 'text-white');
                            el.classList.add('text-green-400');
                        } else if (price < lastBtcPrice) {
                            el.classList.remove('text-green-400', 'text-white');
                            el.classList.add('text-red-500');
                        }
                        lastBtcPrice = price;
                        el.innerText = `$${priceStr}`; 
                    }
                    document.title = `$${priceStr} BTC`;

                    // --- Live Chart Update Logic ---
                    if (candleSeries) {
                        const now = Math.floor(Date.now() / 1000);
                        const timeBucket = now - (now % 3600); // Hourly candle bucket

                        // If no candle or new hour, create new candle
                        if (!currentCandle || currentCandle.time !== timeBucket) {
                            currentCandle = {
                                time: timeBucket,
                                open: price,
                                high: price,
                                low: price,
                                close: price
                            };
                        } else {
                            // Update existing candle
                            currentCandle.high = Math.max(currentCandle.high, price);
                            currentCandle.low = Math.min(currentCandle.low, price);
                            currentCandle.close = price;
                        }
                        candleSeries.update(currentCandle);
                    }

                } else if (data.s === 'ETHUSDT') {
                    // ... (ETH logic same as before) ...
                    const el = document.getElementById('price-eth');
                    if(el) {
                        if(price > lastEthPrice) {
                            el.classList.remove('text-red-500', 'text-white');
                            el.classList.add('text-green-400');
                        } else if (price < lastEthPrice) {
                            el.classList.remove('text-green-400', 'text-white');
                            el.classList.add('text-red-500');
                        }
                        lastEthPrice = price;
                        el.innerText = `$${priceStr}`;
                    }
                }
            };
            ws.onclose = () => setTimeout(connectWebSocket, 5000);
        }
        connectWebSocket();

        // Simulate Gold/Oil Ticker with Flash (Corrected Base Prices)
        // Gold Base: ~5081, Oil Base: ~78
        let lastGold = 5081.60;
        let lastOil = 78.45;

        setInterval(() => {
            const goldNow = (5081.60 + (Math.random() - 0.5) * 5).toFixed(2);
            const oilNow = (78.45 + (Math.random() - 0.5) * 0.3).toFixed(2);

            const elGold = document.getElementById('price-gold');
            const elOil = document.getElementById('price-oil');

            // Gold Flash
            if(goldNow > lastGold) {
                elGold.className = "text-3xl font-medium tracking-tight text-green-400 transition-all duration-300";
            } else {
                elGold.className = "text-3xl font-medium tracking-tight text-red-400 transition-all duration-300";
            }
            // Reset color after flash
            setTimeout(() => elGold.className = "text-3xl font-medium tracking-tight text-yellow-100 transition-all duration-500", 600);
            
            lastGold = goldNow;
            elGold.innerText = `$${goldNow}`;

            // Oil Flash
            if(oilNow > lastOil) {
                elOil.className = "text-3xl font-medium tracking-tight text-green-400 transition-all duration-300";
            } else {
                elOil.className = "text-3xl font-medium tracking-tight text-red-400 transition-all duration-300";
            }
             // Reset color after flash
            setTimeout(() => elOil.className = "text-3xl font-medium tracking-tight text-red-100 transition-all duration-500", 600);

            lastOil = oilNow;
            elOil.innerText = `$${oilNow}`;

        }, 3000);

        // --- 3. Yangon Weather Fetch ---
        async function fetchWeather() {
            try {
                const res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=16.8053&longitude=96.1561&current_weather=true');
                if(!res.ok) throw new Error("Weather API failed");
                const data = await res.json();
                document.getElementById('yangon-weather').innerHTML = `üå§Ô∏è YGN: ${data.current_weather.temperature}¬∞C`;
            } catch (e) {
                document.getElementById('yangon-weather').innerHTML = `üå§Ô∏è YGN: N/A`;
            }
        }
        fetchWeather();

        // --- 4. Load AI Analysis (Burmese Support) ---
        async function loadAIAnalysis() {
            try {
                // Use relative path to avoid CORS issues on same domain
                const url = `data/ai_analysis.json?t=${Date.now()}`; 
                const res = await fetch(url);
                if (!res.ok) throw new Error("JSON not found");
                const data = await res.json();
                
                const feed = document.getElementById('ai-analysis-feed');
                feed.innerHTML = `
                    <div class="bg-blue-900/20 border border-blue-500/30 p-3 rounded-lg mb-3 animate-in fade-in duration-500">
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-xs font-bold text-blue-300">LATEST SIGNAL</span>
                            <span class="text-[10px] text-gray-400">${new Date(data.timestamp).toLocaleTimeString()}</span>
                        </div>
                        <h4 class="font-bold text-white text-sm mb-1">${data.title}</h4>
                        <p class="text-xs text-gray-300 leading-relaxed font-[Padauk]">${data.summary}</p>
                    </div>
                    <div class="space-y-2">
                        <div class="text-xs text-gray-400 font-mono">
                            <span class="text-purple-400">Prediction:</span> <span class="text-white font-bold">${data.prediction}</span><br>
                            <span class="text-green-400">Support:</span> ${data.support} ‚Ä¢ 
                            <span class="text-red-400">Resistance:</span> ${data.resistance}
                        </div>
                    </div>
                `;
            } catch (e) {
                console.log("Analysis Wait Loop...");
            }
        }
        loadAIAnalysis();
        setInterval(loadAIAnalysis, 30000);

    </script>
</body>
</html>